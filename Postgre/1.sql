CREATE TABLE STUDENT_2019091601025(
    StudentID CHAR(13) NOT NULL,
    StudentName VARCHAR(20) NOT NULL,
    Sex VARCHAR(2) NOT NULL,
    CONSTRAINT StudentID_PK PRIMARY KEY(StudentID)
);
CREATE TABLE TEACHER_2019091601025(
    TeacherID CHAR(4) NOT NULL,
    TeacherName VARCHAR(20) NOT NULL,
    College VARCHAR(10) NOT NULL,
    Email VARCHAR(30) NOT NULL,
    CONSTRAINT TeacherID_PK PRIMARY KEY(TeacherID)
);
CREATE TABLE COURSE_2019091601025(
    CourseID CHAR(4) NOT NULL,
    CourseName VARCHAR(20) NOT NULL,
    TeacherID CHAR(4) NOT NULL,
    CONSTRAINT CourseID_PK PRIMARY KEY(CourseID),
    CONSTRAINT TeacherID_FK FOREIGN KEY(TeacherID) REFERENCES TEACHER_2019091601025(TeacherID) ON DELETE CASCADE
);
CREATE TABLE ATTENDANCE_2019091601025(
    AttendID SERIAL NOT NULL,
    StudentID CHAR(13) NOT NULL,
    CourseID CHAR(4) NOT NULL,
    AttendDate DATE NOT NULL,
    CONSTRAINT AttendID_PK PRIMARY KEY(AttendID),
    CONSTRAINT StudentID_FK FOREIGN KEY(StudentID) REFERENCES STUDENT_2019091601025(StudentID) ON DELETE CASCADE,
    CONSTRAINT CourseID_FK FOREIGN KEY(CourseID) REFERENCES COURSE_2019091601025(CourseID) ON DELETE CASCADE
);
INSERT INTO STUDENT_2019091601025
VALUES('2019091601025', '汪炳志', '男');
INSERT INTO STUDENT_2019091601025
VALUES('2019631001101', '黄同学', '女');
INSERT INTO STUDENT_2019091601025
VALUES('2019631001102', '郭同学', '男');
INSERT INTO STUDENT_2019091601025
VALUES('2019631001103', '祝同学', '男');
INSERT INTO TEACHER_2019091601025
VALUES('T001', '赵老师', '软件学院', 'Zhao@uestc.edu.cn');
INSERT INTO TEACHER_2019091601025
VALUES('T002', '林老师', '软件学院', 'lin@uestc.edu.cn');
INSERT INTO TEACHER_2019091601025
VALUES(
        'T003',
        '汪炳志',
        '软件学院',
        '2019091601025@uestc.edu.cn'
    );
INSERT INTO COURSE_2019091601025
VALUES('C001', '数据结构', 'T001');
INSERT INTO COURSE_2019091601025
VALUES('C002', '软件工程', 'T002');
INSERT INTO COURSE_2019091601025
VALUES('C003', '系统设计-2019091601025', 'T003');
INSERT INTO ATTENDANCE_2019091601025
VALUES(DEFAULT, '2019631001101', 'C001', '2021-05-17');
INSERT INTO ATTENDANCE_2019091601025
VALUES(DEFAULT, '2019631001102', 'C002', '2021-05-17');
INSERT INTO ATTENDANCE_2019091601025
VALUES(DEFAULT, '2019631001103', 'C002', '2021-05-17');
INSERT INTO ATTENDANCE_2019091601025
VALUES(DEFAULT, '2019091601025', 'C001', '2021-05-17');
INSERT INTO ATTENDANCE_2019091601025
VALUES(DEFAULT, '2019091601025', 'C002', '2021-05-17');
CREATE VIEW View_attend_2019091601025 AS
SELECT CourseID AS "课程编号",
    CourseName AS "课程名称",
    COUNT(CourseID) AS "出勤人数"
FROM ATTENDANCE_2019091601025 BookID = S.BookID;
CREATE ROLE "Role_Student_2019091601025" WITH LOGIN CONNECTION
LIMIT -1 INHERIT PASSWORD '123456';
CREATE ROLE "Role_Teacher_2019091601025" WITH LOGIN CONNECTION
LIMIT -1 INHERIT PASSWORD '123456';
CREATE ROLE "Role_TAdimn_2019091601025" WITH LOGIN CONNECTION
LIMIT -1 INHERIT PASSWORD '123456';
GRANT SELECT,
    UPDATE ON STUDENT_2019091601025 TO "Role_Student_2019091601025";
GRANT SELECT ON TEACHER_2019091601025 TO "Role_Student_2019091601025";
GRANT SELECT ON COURSE_2019091601025 TO "Role_Student_2019091601025";
GRANT SELECT ON ATTENDANCE_2019091601025 TO "Role_Student_2019091601025";
GRANT SELECT ON STUDENT_2019091601025 TO "Role_Teacher_2019091601025";
GRANT SELECT,
    UPDATE ON TEACHER_2019091601025 TO "Role_Teacher_2019091601025";
GRANT SELECT ON COURSE_2019091601025 TO "Role_Teacher_2019091601025";
GRANT SELECT,
    UPDATE,
    DELETE,
    INSERT ON ATTENDANCE_2019091601025 TO "Role_Teacher_2019091601025";
GRANT SELECT ON STUDENT_2019091601025 TO "Role_TAdimn_2019091601025";
GRANT SELECT ON TEACHER_2019091601025 TO "Role_TAdimn_2019091601025";
GRANT SELECT,
    UPDATE,
    DELETE,
    INSERT ON COURSE_2019091601025 TO "Role_TAdimn_2019091601025";
GRANT SELECT ON ATTENDANCE_2019091601025 TO "Role_TAdimn_2019091601025";
CREATE VIEW View_attend_2019091601018 AS
SELECT COURSE_2019091601018.CourseID AS "课程编号",
    COURSE_2019091601018.CourseName AS "课程名称",
    COUNT(ATTENDANCE_2019091601018.StudentID) AS "出勤人数",
    FROM COURSE_2019091601018,
    ATTENDANCE_2019091601018
WHERE COURSE_2019091601018.CourseID = ATTENDANCE_2019091601018.CourseID CREATE VIEW View_attend_2019091601025 AS
SELECT COURSE_2019091601025.CourseID AS "课程编号",
    COURSE_2019091601025.CourseName AS "课程名称",
    COUNT(ATTENDANCE_2019091601025.StudentID) AS "出勤人数"
FROM COURSE_2019091601025,
    ATTENDANCE_2019091601025
WHERE COURSE_2019091601025.CourseID = ATTENDANCE_2019091601025.CourseID
GROUP BY COURSE_2019091601025.CourseID
ORDER BY COURSE_2019091601025.CourseID DESC;